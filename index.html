<!DOCTYPE html>
<html class="vs-index" lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:include="webroot/frags/layout/head.htm :: header">
<script src="/dist/js/lib/jquery.min.js"></script>
<script src="/dist/js/lib/thymus.min.js" id="thymus"
	data-thx-base-path="." data-thx-frag-extension=".htm"
	data-thx-head-frag="th:include=webroot/frags/layout/head.htm :: header"
	data-thx-preload-js="/dist/js/loader.js"
	data-thx-onfrags="fragsListener();" data-thx-onfrag="fragListener()"></script>
</head>
<body>
<div id="portal" class="wrapper" v-bind:class="pageClass">
	<div th:replace="webroot/frags/layout/navs.htm :: navs"></div>
	<main class="page-wrapper">
	<index inline-template ref="refIndex" v-on:set-state="setState" v-on:set-page="setPage" v-bind:root-state="rootState" v-if="!$root.isLoading">
		<section class="xxx" v-if="!isLoading">

			<div class="d-flex align-items-center px-3 pt-6 txt-c">
				<h4 class="m-0">{{myDashboard.name}}</h4>
				<button type="button" class="btn btn-outline-primary ml-auto" v-on:click="selectWidgets">Add Widget</button>
			</div>

			<draggable ref="orderedQuestions" v-model="preferences.widgets" @update="updateOrder" @clone="clone" :options="widgetOptions" class="fow cards justify-content-center">
				<div class="p-3 card-item" :class="widgetClass(c)" v-for="(c, index) in sortByNested(sort, preferences.widgets)" :key="c.id">
					<component :is="c.comp" :index="index" :data="c"></component>
				</div>
			</draggable>

			<transition name="fade">
			<div th:replace="webroot/frags/api/api-preview.htm :: apiPreview"></div>
			</transition>
			<transition name="fade">
			<div th:replace="webroot/frags/api/app-preview.htm :: appPreview"></div>
			</transition>

			<transition name="fade">
			<div class="column-main-fixed-overlay" v-on:click="cancelSelectWidgets()" v-if="showWidgets"></div>
			</transition>
			<transition name="slide">
			<div class="column-fixed-right" v-if="showWidgets">
				<div class="clearfix column-header column-min-button">
					<div class="column-header-button">
						<button type="button" class="close" v-on:click="cancelSelectWidgets()">×</button>
					</div>
					<h5 class="px-3 py-2 m-0">Choose Widgets</h5>
				</div>
				<div class="nicescroll--bar wk-scroll">
					<div class="p-3">
						<div class="py-2 d-flex align-items-center"  v-for="(w, index) in sortByNested(sort, widgets)" :key="w.id">
							<span class="switch switch-primary mr-3">
								<input type="checkbox" :id="'isactive'+index" v-model="w.isactive" v-on:change="addWidget(w)">
								<label :for="'isactive'+index"></label>
							</span>
							{{w.title}}
						</div>
					</div>
				</div>
			</div>
			</transition>
		</section>
	</index>
	</main>
</div>

<div class="hide">
	<div id="my-apps-subscriptions">
		<div class="card dash-card-2" v-if="!isLoading">
			<div class="card-title handle txt-white" :class="'bg-'+data.color"><h6 class="txt-white d-flex">{{data.title}} <span class="mx-2">{{$root.appList.length}}</span> / <span class="mx-2">{{mySubscriptions}}</span></h6><widget-controls :data="data"></widget-controls></div>
			<div class="fow">
				<div class="fol-sm" v-if="data.chart">
					<highcharts v-if="data.chart" :options="chartOptions"></highcharts>
				</div>
				<div class="fol-sm">
					<div class="card-scroll">
						<div class="my-apps-bar">
							<div v-for="(app, index) in sortByNested(sortApp, $root.appList)" v-if="app.subscriptions" class="brd-b brd-0-last field-controls">
								<a class="nav-link d-block" v-on:click="getMyAppDetail(app,index,true);" :class="{'is-deleted': app.isdeleted}">
									<div class="">										
										<i class="fas fa-check-circle txt-green" title="Active" v-if="!app.isdeleted"></i>
										<i class="fas fa-times-circle txt-red" title="Deleted" v-if="app.isdeleted"></i>
										<strong>{{app.firstname}}</strong>
									</div>
									<div>
										<div class="d-flex txt-uppercase flt-r small txt-muted">
											<span v-if="!app.isdeleted" :title="app.updated | formatDateTime">
												{{app.created | formatDateTime}}
											</span>
											<span class="ml-auto txt-r" v-if="app.isdeleted">
												{{app.deleted | formatDateTime}}
											</span>
										</div>
									</div>
									<code class="d-block txt-line small txt-blue"><small>{{app.uuid}}</small></code>
									<div v-if="app.contracts"><small class="txt-uppercase">Subscriptions:</small> <strong class="txt-black">{{app.subscriptionsCount}}</strong></div>
									<ol class="small pl-3">
										<li v-for="(sub, index) in app.subscriptions">
											<strong>{{sub.apiName}}</strong> by <span>{{sub.apiOwner}}</span>
											<div>{{sub.effectivestartdate | formatDate}} - {{sub.effectiveenddate | formatDate}}</div>
										</li>
									</ol>
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div id="my-business-apis">
		<div class="card dash-card-2" v-if="!isLoading">
			<div class="card-title handle txt-white" :class="'bg-'+data.color"><h6 class="txt-white d-flex">{{data.title}} <span class="mx-2">{{myBusinessApiList.length}}</span></h6><widget-controls :data="data"></widget-controls></div>
			<div class="fow">
				<div class="fol-sm" v-if="data.chart">
					<highcharts v-if="data.chart" :options="chartOptions"></highcharts>
				</div>
				<div class="fol-sm">
					<div class="card-scroll">
						<div class="my-business-bar">
							<api-list v-for="(api, index) in sortByNested(sortApi, myBusinessApiList)" :api="api" :index="index" :subs="false" :business="true" :key="api.uuid" v-if="api.proxies.length > 0" inline-template>
								<div th:replace="webroot/frags/api/api-preview.htm :: apiDash"></div>
							</api-list>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div id="my-proxy-apis">
		<div class="card dash-card-2" v-if="!isLoading">
			<div class="card-title handle txt-white" :class="'bg-'+data.color"><h6 class="txt-white d-flex">{{data.title}} <span class="mx-2">{{myProxyApiList.length}}</span> / <span class="mx-2">{{mySubscribersCount}}</span></h6><widget-controls :data="data"></widget-controls></div>
			<div class="fow">
				<div class="fol-sm" v-if="data.chart">
					<highcharts v-if="data.chart" :options="chartOptions"></highcharts>
				</div>
				<div class="fol-sm">
					<div class="card-scroll">
						<div class="my-proxy-bar">
							<api-list v-for="(api, index) in sortByNested(sortProxy, myProxyApiList)" :api="api" :index="index" :subs="true" :business="true" :key="api.uuid" inline-template>
								<div th:replace="webroot/frags/api/api-preview.htm :: apiDash"></div>
							</api-list>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div id="apis-shared-with-me">
		<div class="card dash-card" v-if="!isLoading">
			<div class="card-title handle" :class="'bg-'+data.color"><h6 class="txt-white">{{data.title}} <span class="mx-2">{{apisSharedWithMe.length}}</span></h6><widget-controls :data="data"></widget-controls></div>
			<div class="card-scroll">
				<div class="shared-with-bar">
					<api-list v-for="(api, index) in apisSharedWithMe" :api="api" :index="index" :key="api.uuid" v-if="!api.isShareDeleted" :subs="false" :business="false" inline-template>
						<div th:replace="webroot/frags/api/api-preview.htm :: apiDash"></div>
					</api-list>
				</div>
			</div>
		</div>
	</div>
	<div id="apis-shared-by-me">
		<div class="card dash-card" v-if="!isLoading">
			<div class="card-title handle" :class="'bg-'+data.color">
				<h6 class="txt-white">{{data.title}} <span class="mx-2">{{apisSharedByMe.length}}</span></h6>
				<widget-controls :data="data"></widget-controls>
			</div>
			<div class="card-scroll">
				<div class="shared-by-bar">
					<api-list v-for="(api, index) in apisSharedByMe" :api="api" :index="index" :key="api.uuid" :subs="false" :business="false" v-if="!api.isShareDeleted" inline-template>
						<div th:replace="webroot/frags/api/api-preview.htm :: apiDash"></div>
					</api-list>
				</div>
			</div>
		</div>
	</div>
	<div id="widget-controls">
		<div class="ficon-actions dropdown dropdown-hover dropdown-full">
			<button type="button" class="dropdown-toggle txt-white" data-toggle="dropdown" aria-expanded="false"><i class="fas fa-ellipsis-h"></i></button>
			<ul class="dropdown-menu dropdown-menu-right" role="menu">
				<li class="p-2">
					<label>Change Title</label>
					<input class="form-control" name="title" v-model.lazy="$parent.data.title" v-on:change="saveWidgets()">
				</li>
				<li class="p-2">
					<label>Change Color</label>
					<select v-model="$parent.data.color" class="form-control txt-white" :class="'bg-'+$parent.data.color" v-on:change="saveWidgets()">
						<option class="bg-blue txt-white" value="blue">Blue</option>
						<option class="bg-indigo txt-white" value="indigo">Indigo</option>
						<option class="bg-purple txt-white" value="purple">Purple</option>
						<option class="bg-pink txt-white" value="pink">Pink</option>
						<option class="bg-red txt-white" value="red">Red</option>
						<option class="bg-orange txt-white" value="orange">Orange</option>
						<option class="bg-yellow txt-white" value="yellow">Yellow</option>
						<option class="bg-green txt-white" value="green">Green</option>
						<option class="bg-teal txt-white" value="teal">Teal</option>
						<option class="bg-cyan txt-white" value="cyan">Cyan</option>
						<option class="bg-black txt-white" value="black">Black</option>
						<option class="bg-grey txt-white" value="grey">Grey</option>
					</select>
				</li>
				<li class="p-2">
					<label>Change Size</label>
					<select v-model="$parent.data.size" class="form-control" v-on:change="saveWidgets()">
						<option value="full">Full</option>
						<option value="1/2">1/2</option>
						<option value="1/3">1/3</option>
						<option value="2/3">2/3</option>
					</select>
				</li>
				<li class="p-2" v-if="$parent.data.chart">
					<label>Change Chart Type</label>
					<select v-model="$parent.data.chart" class="form-control" v-on:change="redraw($event.target.value);saveWidgets()">
						<option :value="null">None</option>
						<option v-for="(type,index) in chartTypes" :value="type">{{type.name}}</option>
					</select>
				</li>
				<li><a title="Remove this widget" v-on:click="$parent.$parent.$parent.deleteWidget(data, index)"><i class="fa fa-trash-alt"></i> Remove Widget</a></li>
			</ul>
		</div>
	</div>
</div>

<script id="reqVue" data-module="index" data-main="/dist/js/main" src="/dist/js/lib/require.min.js"></script>
</body>
</html>