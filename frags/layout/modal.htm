<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<body>
	<div th:fragment="schema" id="schemaModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="schemaModal" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" onclick="schemaEditorClose()" aria-hidden="true">×</button>
					<h5 class="modal-title" id="schemaModalTitle">Schema Editor</h5>
				</div>
				<div class="modal-body p-0">
					<div id="schemaContainer"></div>
				</div>
				<div class="modal-footer d-flex justify-content-between">
					<button type="button" class="btn btn-secondary btn-rounded" onclick="schemaEditorClose()">Close</button>
					<button type="button" class="btn btn-primary btn-rounded" onclick="schemaEditorSave()">Save Changes</button>
				</div>
			</div>
		</div>
	</div>
	<div th:fragment="markdown" id="mdPreview" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mdPreview" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
					<h5 class="modal-title">Markdown Preview</h5>
				</div>
				<div class="modal-body p-3">
					<span id="mdPreviewText"></span>
				</div>
			</div>
		</div>
	</div>
	<div th:fragment="alert" id="alert" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="alert" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-body p-6">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
					<span id="alertText"></span>
				</div>
			</div>
		</div>
	</div>
	<div th:fragment="confirm" id="confirm" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="confirm" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
					<h5 class="modal-title" id="confirmTitle">Alert</h5>
				</div>
				<div class="modal-body p-6">
					<span id="confirmSubtitle"></span>
				</div>
				<div class="modal-footer d-flex justify-content-between">
					<a data-dismiss="modal"><span class="btn btn-secondary btn-rounded">Cancel</span></a>
					<a data-dismiss="modal" id="confirmOk"><span class="btn btn-primary btn-rounded">Confirm</span></a>
				</div>
			</div>
		</div>
	</div>
	<div class="field--controls field-controls-hover" th:fragment="organizations">
		<a class="field-link nav--caret" data-toggle="collapse" v-bind:data-target="'#org'+col+index" v-bind:aria-controls="'org'+col+index">
			<strong class="m-0 txt-blue txt-uppercase d-block txt-r" v-if="title == 'add'">Add Organization <i class="fas fa-fw fa-plus"></i></strong>
			<strong class="m-0" v-if="title == 'edit'">{{org.name}}</strong>
		</a>
		<div class="ficon-actions dropdown dropdown-hover" v-if="title == 'edit'">
			<button type="button" data-toggle="dropdown" aria-expanded="false" class="dropdown-toggle"> <i class="fas fa-ellipsis-h"></i>
			</button>
			<ul role="menu" class="dropdown-menu dropdown-menu-right">
				<li>
					<a title="Remove Organization" v-on:click="deleteOrganization(org)"> <i class="fa fa-fw fa-trash-alt"></i> Remove Organization </a>
				</li>
			</ul>
		</div>
		<div v-bind:id="'org'+col+index" class="collapse clearfix field-tabs">
			<div class="px-3 pt-3 brd-t">
				<div class="form-group" v-bind:class="{ 'has-error': errors.has('name') }">
					<label for="name">Organization Name:</label>
					<input type="text" name="name" v-model="org.name" v-validate="'required|min:2'" class="form-control">
					<em v-bind:class="{ 'show': errors.has('name') }">{{ errors.first('name') }}</em>
				</div>
				<!-- <div class="form-group" v-if="$root.abyssOrgId != org.uuid" v-bind:class="{ 'has-error': errors.has('organization') }"> -->
				<!-- <div class="form-group" v-if="(title == 'edit' && deforg.uuid != org.uuid && org.organizationUser.organizationid != org.organizationUser.organizationrefid) || title == 'add'" v-bind:class="{ 'has-error': errors.has('organization') }"> -->
				<div class="form-group" v-if="(title == 'edit' && deforg.uuid != org.uuid) || title == 'add'" v-bind:class="{ 'has-error': errors.has('organization') }">
					<label>Parent Organization</label>
					<select class="form-control" name="organization" v-model="org.organizationid" v-validate="'required'">
						<option :value="deforg.uuid">{{deforg.name}}</option>
						<option v-for="(o,index) in orgs" :value="o.uuid" v-if="o.uuid != org.uuid">{{o.name}}</option>
					</select>
					<em v-bind:class="{ 'show': errors.has('organization') }">{{ errors.first('organization') }}</em>
				</div>
				<div class="form-group" v-bind:class="{ 'has-error': errors.has('url') }">
					<label for="url">Url:</label>
					<input type="text" name="url" v-model="org.url" class="form-control" v-validate="'url'">
					<em v-bind:class="{ 'show': errors.has('url') }">{{ errors.first('url') }}</em>
				</div>
				<div class="form-group" v-bind:class="{ 'has-error': errors.has('description') }">
					<label for="description">Description:</label>
					<textarea type="text" name="description" v-model="org.description" v-validate="'required'" class="form-control"></textarea>
					<em v-bind:class="{ 'show': errors.has('description') }">{{ errors.first('description') }}</em>
				</div>
				<div class="form-group d-flex justify-content-between">
					<button type="button" class="btn btn-secondary btn-rounded organizations_panel_btn" v-on:click="$root.cancelRightSidebar()">CANCEL</button>
					<button type="button" class="btn btn-primary btn-rounded" v-if="title == 'add'" v-on:click="organizationAction('add', org)">ADD</button>
					<button type="button" class="btn btn-primary btn-rounded" v-if="title == 'edit'" v-on:click="organizationAction('edit', org)">SAVE</button>
				</div>
			</div>
		</div>
	</div>
	<div th:fragment="searchAll">
		<transition name="fade">
		<div class="preview-test-overlay" v-on:click="searchResults = null;searchPaginate = null;" v-if="$root.searchResults"></div>
		</transition>
		<transition name="slide">
		<div class="preview-test" v-if="$root.searchResults">
			<div class="d-flex align-items-center column-header column-min-button">
				<div class="px-3 py-2 m-0">
					<span class="h5 pr-2">{{$root.searchAll}}</span>
					<small>Total Hits</small>
					<div class="badge badge-green mr-2">{{$root.searchResults.hits.total}}</div>
					<small>Took</small>
					<div class="badge badge-green">{{$root.searchResults.took}}</div>
					<small>ms</small>
				</div>
				<select class="form-control form-control-sm w-auto mr-2" v-model="searchSize" v-on:change="changeSearchSize($event.target.value)">
					<option value="5">5</option>
					<option value="10">10</option>
					<option value="25">25</option>
					<option value="50">50</option>
					<option value="100">100</option>
				</select>
				<small>items per page</small>
				<div class="column--header-button ml-auto">
					<button type="button" class="close" v-on:click="searchResults = null;searchPaginate = null;">×</button>
				</div>
			</div>
			<div class="search-results">
				<div class="nicescroll--bar wk-scroll">
					<div class="px-3">
						<div class="nav-horz bg-white">
							<a href="#" class="nav-horz-arrows nav-horz-left" v-if="searchPaginate.first"><i class="fa fa-angle-left"></i></a>
							<a href="#" class="nav-horz-arrows nav-horz-left" v-else v-on:click="onSearchAll(searchPaginate.currentPage - 1);"><i class="fa fa-angle-left"></i></a>
							<nav class="bg-white">
							<ul class="pagination m-0 justify-content-start">
								<!-- <li v-if="!searchPaginate.first"> <a href="#" v-on:click="onSearchAll(searchPaginate.currentPage - 1);"><i class="fa fa-angle-left"></i></a> </li> -->
								<li v-bind:class="{'active': page == searchPaginate.currentPage}" v-for="page in searchPaginate.pages"><a href="#" v-on:click="onSearchAll(page);">{{page + 1}}</a></li>
								<!-- <li v-if="!searchPaginate.last"> <a href="#" v-on:click="onSearchAll(searchPaginate.currentPage + 1);"><i class="fa fa-angle-right"></i></a> </li> -->
							</ul>
							</nav>
							<a href="#" class="nav-horz-arrows nav-horz-right" v-if="searchPaginate.last"><i class="fa fa-angle-right"></i></a>
							<a href="#" class="nav-horz-arrows nav-horz-right" v-else v-on:click="onSearchAll(searchPaginate.currentPage + 1);"><i class="fa fa-angle-right"></i></a>
						</div>
						<div class="row" v-for="(h, index) in sortByNested(sortSearch, $root.searchResults.hits.hits) ">
							<a class="field-link pb-2 nav-caret" data-toggle="collapse" :data-target="'#search'+h._id" :aria-controls="'search'+h._id" aria-expanded="false">
								<div class="d-flex align-items-center">
									<div>
										<strong :class="'badge badge-method badge-' + h._source['@httpmethod']">{{h._source['@httpmethod']}}</strong> 
										<strong v-if="h._type == 'logback'" class="badge badge-primary" title="SEVERITY">{{h._source.severity}}</strong> 
										<strong class="txt-black">{{h._type}}</strong> 
										<small>{{h._source['@httppath']}}</small>
									</div>
									<div class="ml-auto">
										<strong class="txt-black">{{h._source['@timestamp'] | formatDateTimeSec}}</strong> 
									</div> 
								</div>
								<div class="fow small">
									<p class="mb-0 mt-2 fol-sm"><strong class="lbl">index</strong>{{h._index}}</p>
									<p class="mb-0 mt-2 fol-sm" v-if="h._source['@username']"><strong class="lbl">username</strong>{{h._source['@username']}}</p>
									<p class="mb-0 mt-2 fol-sm" v-if="h._source.host"><strong class="lbl">host</strong>{{h._source.host}}</p>
									<p class="mb-0 mt-2 fol-sm" v-if="h._source.thread"><strong class="lbl">thread</strong>{{h._source.thread}}</p>
									<p class="mb-0 mt-2 fol-sm" v-if="h._source.logger"><strong class="lbl">logger</strong>{{h._source.logger}}</p>
									<p class="mb-0 mt-2 fol-sm" v-if="h._type == 'subject-api'">
										<strong class="lbl" v-if="h._source.subjecttypeid == abyssSubjectTypeIds.app">app</strong>
										<strong class="lbl" v-if="h._source.subjecttypeid == abyssSubjectTypeIds.user">user</strong>
										<strong class="lbl" v-if="h._source.subjecttypeid == abyssSubjectTypeIds.group">group</strong>
										{{h._source.displayname}}
									</p>
									<p class="mb-0 mt-2 fol-sm" v-if="h._source.name"><strong class="lbl">name</strong>{{h._source.name}}</p>
									<p class="mb-0 mt-2 fol-sm" v-if="h._source.resourcename"><strong class="lbl">resourcename</strong>{{h._source.resourcename}}</p>
									<p class="mb-0 mt-2 fol-sm" v-if="h._source.type"><strong class="lbl">type</strong>{{h._source.type}}</p>
									<p class="mb-0 mt-2 fol-sm" v-if="h._source.permission"><strong class="lbl">permission</strong>{{h._source.permission}}</p>
									<p class="mb-0 mt-2 fol-sm" v-if="h._source.actionname"><strong class="lbl">actionname</strong>{{h._source.actionname}}</p>
									<p class="mb-0 mt-2 fol-sm-12" v-if="h._source.description"><strong class="lbl">description</strong>{{h._source.description}}</p>
								</div>
							</a>
							<div :id="'search'+h._id" class="collapse">
								<div class="py-2 px-3">
									<pre>{{h._source}}</pre>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		</transition>
	</div>
</body>
</html>